<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <title>Foo</title>
        <script>
            var neuropia = null;
            var Module = {
        onRuntimeInitialized: function() {
            neuropia = Module.create(".")
            const params = Module.params(neuropia); 
            const keys = params.keys();
            const paramList = document.getElementById("paramList");
            for (let i = 0; i < keys.size(); i++) {
                const k = keys.get(i);
                const p = params.get(k);
                const type = p.get(0);
                const value = p.get(1);
               
                const input = document.createElement("INPUT");
                input.setAttribute("name", k)
                input.setAttribute("class", "param");
                switch (type) {
                    case 'interger number':
                        input.setAttribute("type", "number");
                        break;
                     case 'real number':
                        input.setAttribute("type", "number");
                        input.setAttribute("step", "any");
                        break;
                    case 'string':
                        input.setAttribute("type", "text");
                        input.setAttribute("mandatory", "false");
                        break;
                    case 'file':
                        input.setAttribute("type", "file");
                        break;
                    case 'true|false':
                        input.setAttribute("type", "checkbox");
                        break;
                    default:
                        input.setAttribute("type", "text");
                        input.setAttribute("pattern", type);
                }
                input.setAttribute("value", value);
                const th1 = document.createElement("th");
                th1.textContent = k;
                const th2 = document.createElement("th");
                th2.appendChild(input);
                
                const tr = document.createElement("tr");
                const th3 = document.createElement("th");
                th3.setAttribute("name", "name_" + k);
                th3.textContent = type;
                tr.appendChild(th1);
                tr.appendChild(th2);
                tr.appendChild(th3);
                paramList.appendChild(tr)
                console.log('params result: ' + i + " " + k +  '->' + type + " " + value);
            }
        }
    };
        function train() {
            const params = document.getElementsByClassName("param");
            let ok = true;
            for (let i = 0, length = params.length; i < length; i++) {
                const name = params[i].name;
                const value = params[i].value;
                const isOk = Module.setParam(neuropia, name, value);
                ok = ok && isOk;
                let status = document.getElementsByName("name_" + name); 
                if(!isOk) {
                    status[0].setAttribute("style", "color:#ff0000");
                }
                console.log(name + "->" + value + " ? " + isOk)
            }
            if(ok) {
                var radios = document.getElementsByName('type');
                for (var i = 0, length = radios.length; i < length; i++) {
                    if (radios[i].checked) {
                        console.log("start  train");
                        const success = Module.train(neuropia, radios[i].value);
                        consolole.log("training was " + success)
                        if(success) {
                            document.getElementById("verifyBtn").setAttribute("disabled", "false");
                        } else {
                            alert("Cannot with given data!");
                        }
                    }
                    break;
                }
            }
            return false;
        }
		</script>
        <script src="neuropia_t.js"></script>
	</head>
	<body>
        <form name="params" onsubmit="return train()">
            <table id="paramList" align="left"></table>
            <input type="radio" name="type" value="Basic" checked> Basic<br>
            <input type="radio" name="type" value="Evo"> Evolutional <br>
            <input type="radio" name="type" value="Parallel"> Parallel <br>  
            <input type="submit" name="Train" value="Train"/>
        </form>
        <button type="button" onclick="verify()" disabled="true" id="verifyBtn">Verify</button>
	</body>
</html>
